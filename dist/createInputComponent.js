/*! 2016 Baidu Inc. All Rights Reserved */
!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./babelHelpers","react","./Validator"],t);else if("undefined"!=typeof exports)t(exports,require("./babelHelpers"),require("react"),require("./Validator"));else{var r={exports:{}};t(r.exports,e.babelHelpers,e.react,e.Validator),e.createInputComponent=r.exports}}(this,function(exports,e,t,r){"use strict";var i=t.PropTypes,n=t.createClass({displayName:"InputComponent",propTypes:{name:i.string,pointer:i.string,validate:i.func,renderErrorMessage:i.func,onChange:i.func,validator:i.shape({validate:i.func.isRequired})},getDefaultProps:function(){return{defaultValue:""}},getInitialState:function(){var e=this.props.name;this.validator=this.props.validator||this.context.validator||r;var t=this.context.pointer;this.pointer=null!=e&&t?""+this.context.pointer+e:null;var i=this.props,n=i.value,o=i.defaultValue;return{value:null!=n?n:o}},contextTypes:{pointer:i.string,validator:i.shape({validate:i.func.isRequired}),attachForm:i.func,detachForm:i.func},childContextTypes:{pointer:i.string},getChildContext:function(){var e=this.pointer;return{pointer:e?e+"/":null}},componentDidMount:function(){var e=this.context.attachForm;if(e)e(this)},componentWillUnmount:function(){var e=this.context.detachForm;if(e)e(this)},componentWillReceiveProps:function(e){var t=e.customValidity,r=e.defaultValue,i=e.value,n=void 0===i?r:i;if(n!==this.getValue()||t!==this.props.customValidity)this.setState({value:n,validity:t?this.validator.createCustomValidity(t):this.checkValidity(n)})},validate:function(e){var t=this.checkValidity(e);return this.setState({validity:t}),t},checkValidity:function(e){return this.validator.validate(e,this)},onChange:function o(e){var o=this.props.onChange;if(o)return void o(e);var t=e.value;if(t!==this.state.value){var r=this.props.customValidity;this.setState({value:t,validity:r?this.validator.createCustomValidity(r):this.checkValidity(t)})}},getValue:function(){var e=this.child;if(e){if("function"==typeof e.getValue)return e.getValue();if(e.props.value)return e.props.value}return this.state.value},render:function(){var r=this,i=this.props,n=this.onChange,o=this.pointer,a=i.children,l=i.validate,s=void 0===l?this.validate:l,u=e.objectWithoutProperties(i,["children","validate"]),p=this.state,d=p.value,c=p.validity,f=t.cloneElement(t.Children.only(a),e["extends"]({},u,{pointer:o,validity:c,validate:s,value:d,onChange:n,ref:function(e){if(e)r.child=e}}));return f}});exports.isValidInputElement=function(e){return t.isValidElement(e)&&e.props.type===n},exports.InputComponent=n,exports.create=function(e){var r=t.createClass({displayName:e.displayName+"InputWrapper",render:function(){var r=this.props,i=r.children;return t.createElement(n,r,t.createElement(e,r,i))}});return r.defaultProps=e.defaultProps,r.propTypes=e.propTypes,r}});